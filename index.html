<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Launcher | Hexindo Fleet</title>
    <meta name="theme-color" content="#f0fdf4">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --mint-primary: #87cf3a;
            --mint-dark: #2f343f;
        }

        body {
            background: linear-gradient(135deg, #e0eecf 0%, #f0fdf4 100%);
            height: 100vh;
            overflow: hidden;
            font-family: 'Rajdhani', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--mint-dark);
        }

        /* --- MECHA CANVAS --- */
        #particle-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0.6;
        }

        /* --- LOADER UI --- */
        .loader-container {
            position: relative; z-index: 10;
            text-align: center;
            animation: fadeIn 0.8s ease-out;
        }

        .spinner-ring {
            width: 80px; height: 80px;
            border: 4px solid rgba(135, 207, 58, 0.2);
            border-top: 4px solid var(--mint-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px auto;
            box-shadow: 0 0 20px rgba(135, 207, 58, 0.4);
        }

        .logo-text {
            font-size: 24px; font-weight: 800; letter-spacing: 0.1em;
            text-transform: uppercase; color: #2f343f;
        }
        
        .status-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px; font-weight: 700;
            color: #64748b; margin-top: 8px;
            text-transform: uppercase; letter-spacing: 0.15em;
        }

        .progress-bar {
            width: 200px; height: 4px; background: #e2e8f0;
            border-radius: 10px; margin: 15px auto 0; overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%; background: var(--mint-primary);
            width: 0%; border-radius: 10px;
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>

    <div class="loader-container">
        <div class="spinner-ring"></div>
        <h1 class="logo-text">HEXINDO <span class="text-[#87cf3a]">FLEET</span></h1>
        <div class="progress-bar"><div class="progress-fill" id="p-fill"></div></div>
        <p class="status-text" id="status-msg">INITIALIZING SYSTEM...</p>
        <p class="text-[9px] text-slate-400 mt-8 font-mono">V3.0 MINT EDITION</p>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        // Pilih versi mana yang akan dibuka (mint-version atau mecha-version)
        const TARGET_FOLDER = 'mint-version'; 
        
        // --- 2. SERVICE WORKER REGISTRATION ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered [Root]', reg))
                    .catch(err => console.log('SW Fail', err));
            });
        }

        // --- 3. REDIRECT LOGIC ---
        const App = {
            init() {
                this.animateCanvas();
                this.checkSession();
            },

            checkSession() {
                const fill = document.getElementById('p-fill');
                const msg = document.getElementById('status-msg');

                // Step 1: Boot
                setTimeout(() => {
                    fill.style.width = "40%";
                    msg.innerText = "LOADING MODULES...";
                }, 300);

                // Step 2: Check Auth
                setTimeout(() => {
                    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                    fill.style.width = "80%";
                    msg.innerText = isLoggedIn ? "VERIFYING IDENTITY..." : "SECURE CONNECTION...";
                    
                    // Step 3: Redirect
                    setTimeout(() => {
                        fill.style.width = "100%";
                        if (isLoggedIn) {
                            msg.innerText = "ACCESS GRANTED";
                            msg.style.color = "#16a34a"; // Green
                            window.location.replace(`./${TARGET_FOLDER}/index.html`);
                        } else {
                            msg.innerText = "LOGIN REQUIRED";
                            window.location.replace(`./${TARGET_FOLDER}/login.html`);
                        }
                    }, 800); // Waktu tunggu animasi sebelum pindah
                }, 800);
            },

            animateCanvas() {
                const canvas = document.getElementById('particle-canvas');
                const ctx = canvas.getContext('2d');
                let width, height;
                let particles = [];

                const resize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };
                window.addEventListener('resize', resize);
                resize();

                class Particle {
                    constructor() {
                        this.x = Math.random() * width;
                        this.y = Math.random() * height;
                        this.size = Math.random() * 3 + 1;
                        this.speedY = Math.random() * 1 + 0.2;
                        this.color = Math.random() > 0.5 ? '135, 207, 58' : '200, 200, 200';
                    }
                    update() {
                        this.y -= this.speedY;
                        if (this.y < 0) this.y = height;
                    }
                    draw() {
                        ctx.fillStyle = `rgba(${this.color}, 0.3)`;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                for (let i = 0; i < 40; i++) particles.push(new Particle());

                const animate = () => {
                    ctx.clearRect(0, 0, width, height);
                    particles.forEach(p => { p.update(); p.draw(); });
                    requestAnimationFrame(animate);
                };
                animate();
            }
        };

        App.init();
    </script>
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Terminal Synced:', reg.scope))
                .catch(err => console.log('Sync Failed:', err));
        });
    }
</script>

</body>
</html>
